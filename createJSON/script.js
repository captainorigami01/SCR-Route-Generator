routes = {"R001":{"operator":"connect","duration":"18","trains":["A","-68","-444"],"stops":["Stepford Central","Stepford East","St Helens Bridge","Angel Pass","Bodin","Coxly","Benton","Benton Bridge","Stepford Airport Parkway","Stepford Airport Central"]},"R002":{"operator":"connect","duration":"13","trains":["A","-68","-444"],"stops":["Stepford Central","Stepford East","St Helens Bridge","Angel Pass","Bodin","Coxly","Benton","Port Benton"]},"R003":{"operator":"connect","duration":"23","trains":["A"],"stops":["Stepford Central","Stepford East","St Helens Bridge","Angel Pass","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Upper Staploe","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City"]},"R004":{"operator":"connect","duration":"16","trains":["A"],"stops":["St Helens Bridge","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Water Newton","Leighton Stepford Road","Leighton City","Edgemead"]},"R005":{"operator":"connect","duration":"22","trains":["A","-68","-444"],"stops":["Stepford Victoria","Financial Quarter","City Hospital","Stepford Central","Stepford East","St Helens Bridge","Bodin","Coxly","Benton","Benton Bridge","Stepford Airport Parkway","Stepford Airport Parkway"]},"R006":{"operator":"connect","duration":"17","trains":["A"],"stops":["Stepford Victoria","Financial Quarter","City Hospital","Stepford Central","Stepford East","St Helens Bridge","Angel Pass","Bodin","Coxly","Benton","Port Benton"]},"R007":{"operator":"connect","duration":"10","trains":["A"],"stops":["Stepford Central","Stepford East","St Helens Bridge","Elsemere Junction","Berrily","East Berrily","East Berrily","Beaulieu Park","Morganstown"]},"R008":{"operator":"connect","duration":"10","trains":["A","-68","-444"],"stops":["Stepford Victoria","Financial Quarter","Stepford Central","Stepford East","St Helens Bridge","Elsemere Pond","Elsemere Junction","Berrily"]},"R009":{"operator":"connect","duration":"26","trains":["A"],"stops":["Stepford Victoria","Stepford Central","Stepford East","St Helens Bridge","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City","Edgemead"]},"R020":{"operator":"connect","duration":"11","trains":["A","-68","-444"],"stops":["Stepford Central","Stepford East","Stepford High Street","Whitefield Lido","Stepford United Football Club","Woodhead Lane","Houghton Rake","Whitefield"]},"R021":{"operator":"connect","duration":"6","trains":["A","-68","-444"],"stops":["Stepford Central","Stepford East","Stepford High Street","Whitefield Lido","Stepford United Football Club"]},"R022":{"operator":"connect","duration":"8","trains":["A"],"stops":["Beechley","Stepford Central","Stepford East","Stepford High Street","Stepford United Football Club","Woodhead Lane","Whitefield"]},"R023":{"operator":"connect","duration":"10","trains":["A","-68","-444"],"stops":["Stepford Victoria","Financial Quarter","City Hospital","Stepford Central","Stepford East","Stepford High Street","Whitefield Lido","Stepford United Football Club"]},"R024":{"operator":"connect","duration":"43","trains":["A"],"stops":["Stepford Central","Stepford East","St Helens Bridge","Angel Pass","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City","Edgemead","Faymere","Westercoast","Millcastle","Westwyvern","Starryloch","Northshore","Llyn-By-The-Sea"]},"R025":{"operator":"connect","duration":"31","trains":["A"],"stops":["St Helens Bridge","Angel Pass","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Upper Staploe","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City","Edgemead","Faymere","Westercoast","Millcastle Racecourse","Millcastle","Westwyvern"]},"R026":{"operator":"connect","duration":"34","trains":["68","444"],"stops":["Stepford Victoria","Stepford Central","Stepford East","St Helens Bridge","Bodin","Coxly","Benton","Hampton Hargate","Water Newton","Leighton Stepford Road","Leighton City","Edgemead","Westercoast","Millcastle","Westwyvern","Northshore","Llyn-By-The-Sea"]},"R027":{"operator":"connect","duration":"8","trains":["A","-68","-444"],"stops":["Stepford Central","Stepford East","St Helens Bridge","New Harrow","Elsemere Pond","Elsemere Junction","Berrily"]},"R028":{"operator":"connect","duration":"7","trains":["A"],"stops":["Stepford Victoria","Financial Quarter","Beechley","Hemdon Park","Willowfield"]},"R029":{"operator":"connect","duration":"3","trains":["A"],"stops":["Stepford Victoria","Financial Quarter","Beechley"]},"R030":{"operator":"connect","duration":"12","trains":["A"],"stops":["Willowfield","Hemdon Park","Beechley","Stepford Central","Stepford East","St Helens Bridge","New Harrow","Elsemere Pond","Berrily"]},"R031":{"operator":"connect","duration":"12","trains":["A"],"stops":["Willowfield","Hemdon Park","Beechley","City Hospital","Stepford Central","Stepford East","Stepford High Street","Whitefield Lido","Stepford United Football Club"]},"R032":{"operator":"connect","duration":"R032","trains":["A"],"stops":["Willowfield","Beechley","Stepford Central","Stepford East","St Helens Bridge","Bodin","Coxly","Benton","Port Benton"]},"R033":{"operator":"connect","duration":"20","trains":["A"],"stops":["Beechley","City Hospital","Stepford East","St Helens Bridge","Angel Pass","Bodin","Coxly","Benton","Benton Bridge","Stepford Airport Parkway","Stepford Airport Central"]},"R034":{"operator":"connect","duration":"11","trains":["A"],"stops":["Beechley","City Hospital","Stepford Central","Stepford East","St Helens Bridge","New Harrow","Elsemere Junction","Berrily","Beaulieu Park","Morganstown"]},"R035":{"operator":"connect","duration":"38","trains":["A"],"stops":["Willowfield","Beechley","Stepford Central","Stepford East","St Helens Bridge","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Water Newton","Leighton Stepford Road","Leighton City","Edgemead","Faymere","Westercoast","Millcastle","Westwyvern"]},"R036":{"operator":"connect","duration":"36","trains":["68","444"],"stops":["Willowfield","Beechley","Stepford Central","Stepford East","St Helens Bridge","Bodin","Coxly","Benton","Hampton Hargate","Water Newton","Leighton Stepford Road","Leighton City","Edgemead","Westercoast","Millcastle","Westwyvern","Northshore","Llyn-By-The-Sea"]},"R037":{"operator":"connect","duration":"16","trains":["A"],"stops":["Leighton City","Edgemead","Faymere","Westercoast","Millcastle","Westwyvern","Northshore","Llyn-By-The-Sea"]},"R038":{"operator":"connect","duration":"12","trains":["A"],"stops":["Leighton City","Edgemead","Faymere","Westercoast","Millcastle Racecourse","Millcastle","Westwyvern"]},"R039":{"operator":"connect","duration":"12","trains":["A"],"stops":["Benton","Benton Bridge","Hampton Hargate","Upper Staploe","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City"]},"R040":{"operator":"connect","duration":"17","trains":["A"],"stops":["Edgemead","Faymere","Westercoast","Millcastle Racecourse","Millcastle","Westwyvern","Starryloch","Northshore","Llyn-By-The-Sea"]},"R041":{"operator":"connect","duration":"3","trains":["A"],"stops":["Edgemead","Leighton West"]},"R042":{"operator":"connect","duration":"18","trains":["A"],"stops":["Leighton West","Edgemead","Faymere","Westercoast","Millcastle","Westwyvern","Starryloch","Northshore","Llyn-By-The-Sea"]},"R043":{"operator":"connect","duration":"3","trains":["A"],"stops":["Leighton City","Leighton West"]},"R044":{"operator":"connect","duration":"13","trains":["A"],"stops":["Benton","Benton Bridge","Hampton Hargate","Upper Staploe","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City","Leighton West"]},"R045":{"operator":"connect","duration":"26","trains":["A"],"stops":["Stepford Victoria","Financial Quarter","City Hospital","Stepford Central","Stepford East","St Helens Bridge","Angel Pass","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Upper Staploe","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City"]},"R046":{"operator":"connect","duration":"23","trains":["A","-68","-444"],"stops":["Stepford Victoria","Financial Quarter","City Hospital","Stepford Central","Stepford East","St Helens Bridge","Bodin","Coxly","Benton","Benton Bridge","Stepford Airport Parkway","Stepford Airport Central","Airport Terminal 2"]},"R047":{"operator":"connect","duration":"9","trains":["A"],"stops":["St Helens Bridge","Angel Pass","Bodin","Coxly","Benton","Port Benton"]},"R048":{"operator":"connect","duration":"16","trains":["A"],"stops":["St Helens Bridge","Bodin","Coxly","Benton","Stepford Airport Parkway","Stepford Airport Central","Airport Terminal 2"]},"R010":{"operator":"waterline","duration":"10","trains":["A"],"stops":["Newry","Eden Quay","Faraday Road","West Benton","Benton","Port Benton","Morganstown Docks","Whitney Green","Greenslade"]},"R011":{"operator":"waterline","duration":"10","trains":["A"],"stops":["Newry","Eden Quay","Faraday Road","West Benton","Benton","Cambridge Street Parkway","Ashlan Park","Connolly"]},"R012":{"operator":"waterline","duration":"12","trains":["A"],"stops":["Newry Harbour","Newry","Eden Quay","Faraday Road","West Benton","Benton","Cambridge Street Parkway","Ashlan Park","Connolly"]},"R013":{"operator":"waterline","duration":"4","trains":["A"],"stops":["Benton","Port Benton","Morganstown Docks","Whitney Green","Greenslade"]},"R014":{"operator":"waterline","duration":"15","trains":["A"],"stops":["Newry","Eden Quay","Faraday Road","West Benton","Benton","Cambridge Street Parkway","Airport West","Farleigh","Esterfield"]},"R015":{"operator":"waterline","duration":"4","trains":["143","165","171","195/0"],"stops":["Benton","Port Benton","Morganstown Docks","Morganstown"]},"R016":{"operator":"waterline","duration":"10","trains":["A"],"stops":["Benton","Cambridge Street Parkway","Airport West","James Street","Farleigh","Rosedale Village","Esterfield"]},"R017":{"operator":"waterline","duration":"12","trains":["A"],"stops":["Newry","Eden Quay","Faraday Road","West Benton","Benton","Cambridge Street Parkway","Airport West","Airport Terminal 2"]},"R018":{"operator":"waterline","duration":"15","trains":["A"],"stops":["Newry Harbour","Newry","Eden Quay","Faraday Road","West Benton","Benton","Cambridge Street Parkway","Airport West","James Street","Farleigh"]},"R051":{"operator":"airlink","duration":"8","trains":["A","-345"],"stops":["Stepford Central","Stepford Airport Central"]},"R052":{"operator":"airlink","duration":"10","trains":["A","-345"],"stops":["Stepford Central","Stepford Airport Central","Airport Terminal 1","Airport Terminal 2"]},"R053":{"operator":"airlink","duration":"13","trains":["A","-345"],"stops":["Stepford Central","Stepford East","Elsemere Junction","Morganstown","Stepford Airport Central","Airport Terminal 1","Airport Terminal 2"]},"R054":{"operator":"airlink","duration":"10","trains":["A","-345"],"stops":["Stepford Central","St Helens Bridge","Berrily","Stepford Airport Parkway","Stepford Airport Central"]},"R055":{"operator":"airlink","duration":"15","trains":["A","-345"],"stops":["Stepford Central","Stepford East","Stepford Airport Parkway","Stepford Airport Parkway","Stepford Airport Central","Airport Terminal 2","Airport Terminal 3"]},"R056":{"operator":"airlink","duration":"7","trains":["A","-345"],"stops":["Stepford Airport Central","Stepford Airport Parkway","Leighton Stepford Road"]},"R057":{"operator":"airlink","duration":"12","trains":["A","-345"],"stops":["Airport Terminal 3","Airport Terminal 2","Stepford Airport Central","Leighton Stepford Road"]},"R058":{"operator":"airlink","duration":"15","trains":["A","-345"],"stops":["Stepford Central","St Helens Bridge","Morganstown","Stepford Airport Central","Airport Terminal 1","Airport Terminal 2","Airport Terminal 3"]},"R059":{"operator":"airlink","duration":"13","trains":["A","-345"],"stops":["Stepford Central","St Helens Bridge","Elsemere Junction","Stepford Airport Parkway","Stepford Airport Central","Airport Terminal 2"]},"R060":{"operator":"airlink","duration":"5 - 9","trains":["345"],"stops":["Stepford Airport Parkway","Stepford Airport Central","Airport Terminal 1","Airport Terminal 3","Airport Terminal 2"]},"R075":{"operator":"express","duration":"5","trains":["A","-43/5"],"stops":["Stepford Central","Benton"]},"R076":{"operator":"express","duration":"13","trains":["A"],"stops":["Stepford Central","St Helens Bridge","Benton","Leighton Stepford Road","Leighton City"]},"R077":{"operator":"express","duration":"24","trains":["A","-43/5"],"stops":["Stepford Central","St Helens Bridge","Benton","Leighton Stepford Road","Leighton City","Edgemead","Westwyvern","Northshore","Llyn-By-The-Sea"]},"R078":{"operator":"express","duration":"20","trains":["A"],"stops":["Stepford Central","Benton","Leighton Stepford Road","Leighton City","Westwyvern","Llyn-By-The-Sea"]},"R079":{"operator":"express","duration":"6","trains":["A","-43/5"],"stops":["Stepford Central","St Helens Bridge","Benton"]},"R080":{"operator":"express","duration":"21","trains":["A","-43/5"],"stops":["Stepford Central","St Helens Bridge","Morganstown","Leighton Stepford Road","Leighton City","Westwyvern","Northshore","Llyn-By-The-Sea"]},"R081":{"operator":"express","duration":"16","trains":["A"],"stops":["Stepford Central","Leighton City","Llyn-By-The-Sea"]},"R082":{"operator":"express","duration":"18","trains":["A","-43/5"],"stops":["Stepford Central","Elsemere Junction","Morganstown","Leighton Stepford Road","Leighton City","Edgemead","Westwyvern"]},"R083":{"operator":"express","duration":"23","trains":["A"],"stops":["Newry","Benton","Morganstown","Leighton Stepford Road","Leighton City","Westercoast","Northshore","Llyn-By-The-Sea"]},"R084":{"operator":"express","duration":"26","trains":["A"],"stops":["Newry Harbour","Newry","Benton","Leighton Stepford Road","Leighton City","Westwyvern","Llyn-By-The-Sea"]},"R085":{"operator":"express","duration":"20","trains":["A"],"stops":["Benton","Morganstown","Leighton Stepford Road","Leighton City","Northshore","Llyn-By-The-Sea"]},"R086":{"operator":"express","duration":"13","trains":["220","221","801"],"stops":["Newry","Eden Quay","Benton","Leighton Stepford Road","Leighton City"]}};
trains = {"43":{"operator":"express","length":"1+4+1"},"68":{"operator":"connect","length":"3x Mk3s + 2x 68's"},"143":{"operator":"waterline","length":"2"},"166":{"operator":"waterline","length":"3"},"168":{"operator":"connect","length":"4"},"170":{"operator":"connect","length":"3"},"171":{"operator":"waterline","length":"2"},"185":{"operator":"connect","length":"3"},"195":{"operator":"connect","length":"2 + 2"},"220":{"operator":"express","length":"4"},"221":{"operator":"express","length":"5"},"319":{"operator":"waterline","length":"3"},"321":{"operator":"connect","length":"4"},"333":{"operator":"connect","length":"4"},"345":{"operator":"airlink","length":"7"},"350":{"operator":"connect","length":"4"},"357":{"operator":"connect","length":"4"},"360":{"operator":"connect","length":"4"},"365":{"operator":"connect","length":"4"},"377":{"operator":"connect","length":"5"},"379":{"operator":"waterline","length":"4"},"387":{"operator":"airlink","length":"4"},"397":{"operator":"airlink","length":"5"},"444":{"operator":"connect","length":"5"},"508":{"operator":"waterline","length":"3"},"707":{"operator":"connect","length":"5"},"717":{"operator":"connect","length":"6"},"720":{"operator":"connect","length":"5"},"730":{"operator":"connect","length":"5"},"801":{"operator":"express","length":"5"},"802":{"operator":"airlink","length":"5"},"158/0":{"operator":"connect","length":"3"},"158/9":{"operator":"connect","length":"2"},"331/0":{"operator":"connect","length":"3"},"331/1":{"operator":"connect","length":"4"},"380/0":{"operator":"connect","length":"3"},"380/1":{"operator":"connect","length":"4"},"458/0":{"operator":"connect","length":"4"},"458/5":{"operator":"connect","length":"4"},"143D":{"operator":"waterline","length":"2+2"},"165/0":{"operator":"waterline","length":"2"},"165/1":{"operator":"waterline","length":"2+2"},"195/0":{"operator":"waterline","length":"2"},"195/1":{"operator":"waterline","length":"3"},"185A":{"operator":"airlink","length":"3"},"185AD":{"operator":"airlink","length":"3+3"},"332/0":{"operator":"airlink","length":"4"},"332/1":{"operator":"airlink","length":"5"},"360/0":{"operator":"airlink","length":"4"},"360/5":{"operator":"airlink","length":"5"},"755/3":{"operator":"airlink","length":"2+1+1"},"755/4":{"operator":"airlink","length":"2+1+2"},"43/5":{"operator":"express","length":"1+5+1"},"43 Buffer":{"operator":"express","length":"1+4+1"},"397/0":{"operator":"express","length":"5"}};
operators = ["connect", "waterline", "airlink", "express"];
userJson = {"routes":{"owned": []},"trains":{"owned": []},"operators":{"owned": []}};
/*
<div class="card">
  <div class="card-header">
    Featured
  </div>
  <div class="card-body">
    <h5 class="card-title">Special title treatment</h5>
    <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
    <a href="#" class="btn btn-primary">Go somewhere</a>
  </div>
</div>
*/
cards = "";

function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for(let i = 0; i <ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}


for(operator in operators){
    op = operators[operator];
    cards += "<div onclick='selectOperator(\""+op+"\")' id='"+op+"' class='card'><div class='card-header'>Operator: "+op+"</div>";


    cards += "<div class='card-body'><h5 class='card-title'>"+op+"</h5>";
    cards += "<p class='card-text'>Operator: "+op+"</p>";
    cards += "</div></div>";
}

for (route in routes){
    cards += "<div onclick='selectRoute(\""+route+"\")' id='"+route+"' class='card'><div class='card-header'>"+route+"</div>";

    start = routes[route]["stops"][0]
    end = routes[route]["stops"][routes[route]["stops"].length-1]

    cards += "<div class='card-body'><h5 class='card-title'>"+start+" - "+end+"</h5>";
    cards += "<p class='card-text'>Operator: "+routes[route]["operator"]+" - Duration: "+routes[route]["duration"]+" minutes</p>";
    cards += "</div></div>";
}

for(train in trains){
    cards += "<div onclick='selectTrain(\""+train+"\")' id='"+train+"' class='card'><div class='card-header'>Class "+train+"</div>";
    cards += "<div class='card-body'><h5 class='card-title'>Operator: "+trains[train]["operator"]+"</h5>";
    cards += "<p class='card-text'>Length: "+trains[train]["length"]+"</p>";
    cards += "</div></div>";

}

function selectRoute(routeID){
    document.getElementById(routeID).classList.toggle("selected");
    routesOwned = userJson["routes"]["owned"];
    if (routesOwned.includes(routeID)){
        idx = routesOwned.indexOf(routeID);
        routesOwned.splice(idx, 1);
        userJson["routes"]["owned"] = routesOwned;
    }else{
        routesOwned.push(routeID)
        userJson["routes"]["owned"] = routesOwned
    }
}

function selectTrain(trainID){
    document.getElementById(trainID).classList.toggle("selected");
    trainsOwned = userJson["trains"]["owned"];
    if (trainsOwned.includes(trainID)){
        idx = trainsOwned.indexOf(trainID);
        trainsOwned.splice(idx, 1);
        userJson["trains"]["owned"] = trainsOwned;
    }else{
        trainsOwned.push(trainID)
        userJson["trains"]["owned"] = trainsOwned
    }
}

function selectOperator(operatorID){
    document.getElementById(operatorID).classList.toggle("selected");
    operatorsOwned = userJson["operators"]["owned"];
    if (operatorsOwned.includes(operatorID)){
        idx = operatorsOwned.indexOf(operatorID);
        operatorsOwned.splice(idx, 1);
        userJson["operators"]["owned"] = operatorsOwned;
    }else{
        operatorsOwned.push(operatorID)
        userJson["operators"]["owned"] = operatorsOwned
    }
}

function loadItems(){
    document.getElementById("myCards").innerHTML = cards;
}

function createJson(){
    // console.log(userJson);
       outputJson = JSON.stringify(userJson);
    var file = new File(["\ufeff"+outputJson], "ownedRoutesTrains.json", {type: "application/json:charset=UTF-8"});

    url = window.URL.createObjectURL(file);
    var a = document.createElement("a");
    a.style = "display:none;";
    a.href = url;
    a.download = file.name;
    a.click();
    window.URL.revokeObjectURL(url);

    let date = new Date();
    date.setTime(date.getTime() + (365*24*60*60*1000));
    var expires = date.toUTCString();
    document.cookie = "JSONdata="+outputJson+";expires="+expires+";path=/";

}

function getOwnedRoutesPrevious(){
    if (getCookie("JSONdata") == ""){
        outputJson = JSON.stringify(userJson);
        let date = new Date();
        date.setTime(date.getTime() + (365*24*60*60*1000));
        var expires = date.toUTCString();
        document.cookie = "JSONdata="+outputJson+"; expires="+expires+";path=/";
    }else{
        userJson = JSON.parse(getCookie("JSONdata"));
        for(route in userJson["routes"]["owned"]){
            routeID = userJson["routes"]["owned"][route]
            console.log(routeID);
            document.getElementById(routeID).classList.add("selected");
        }
        for(operator in userJson["operators"]["owned"]){
            operatorID = userJson["operators"]["owned"][operator];
            document.getElementById(operatorID).classList.add("selected");
        }
        for(train in userJson["trains"]["owned"]){
            trainID = userJson["trains"]["owned"][train];
            document.getElementById(trainID).classList.add("selected");
        }
    }
}